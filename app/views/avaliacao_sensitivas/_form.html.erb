<%= form_for(avaliacao_sensitiva) do |f| %>
  <% if avaliacao_sensitiva.errors.any? %>
    <div id="error_explanation" class="card-panel red white-text">
      <h5>Resolva os problemas a seguir antes de Salvar:</h5>

      <ul>
      <% avaliacao_sensitiva.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
<div class="card-panel">
  


    


  <div class="input-field">

    <%= f.label :data %>
    <%= f.text_field :data, class: "datepicker" %>
    
  </div>

  <div class="row">
    <div class="col s12 l4 center-container">
      <!-- Image Map Generated by http://www.image-map.net/ -->
      <canvas id="cnvs_mao_direita" width=400 height=321 style="border: 1px solid red;"></canvas>
      <img id="mao_direita" src="/images/mao_direita.png" usemap="#image-map">


      <map name="image-map">
        <area target="" alt="mao_d_costa" title="mao_d_costa" href="" coords="290,162,15" shape="circle">
        <area target="" alt="mindinho_d_ponta" title="mindinho_d_ponta" href="" coords="30,66,11" shape="circle">
        <area target="" alt="mindinho_d" title="mindinho_d" href="" coords="32,116,13" shape="circle">
        <area target="" alt="mao_direita" title="mao_direita" href="" coords="29,180,14" shape="circle">
        <area target="" alt="indicador_d_ponta" title="indicador_d_ponta" href="" coords="145,68,12" shape="circle">
        <area target="" alt="indicador_d" title="indicador_d" href="" coords="123,114,15" shape="circle">
        <area target="" alt="dedao_direito" title="dedao_direito" href="" coords="172,176,14" shape="circle">
      </map>
    </div>
  </div>


  <%= f.hidden_field :avaliacao_notificacao_id  %>
  <%= f.hidden_field :dedao_direito %>
  <%= f.hidden_field :indicador_d_ponta %>
  <%= f.hidden_field :indicador_d %>
  <%= f.hidden_field :mindinho_d_ponta %>
  <%= f.hidden_field :mindinho_d %>
  <%= f.hidden_field :mao_direita %>
  <%= f.hidden_field :mao_d_costa %>
  <%= f.hidden_field :dedao_esquerdo %>
  <%= f.hidden_field :indicador_e_ponta %>
  <%= f.hidden_field :indicador_e %>
  <%= f.hidden_field :mindinho_e_ponta %>
  <%= f.hidden_field :mindinho_e %>
  <%= f.hidden_field :mao_esquerda %>
  <%= f.hidden_field :mao_e_costa %>
  <%= f.hidden_field :pe_direito %>
  <%= f.hidden_field :pe_d_1_ponta %>
  <%= f.hidden_field :pe_d_3_ponta %>
  <%= f.hidden_field :pe_d_5_ponta %>
  <%= f.hidden_field :pe_d_1 %>
  <%= f.hidden_field :pe_d_3 %>
  <%= f.hidden_field :pe_d_5 %>
  <%= f.hidden_field :pe_d_e1 %>
  <%= f.hidden_field :pe_d_e1 %>
  <%= f.hidden_field :pe_d_calcanhar %>
  <%= f.hidden_field :pe_esquerdo %>
  <%= f.hidden_field :pe_e_1_ponta %>
  <%= f.hidden_field :pe_e_3_ponta %>
  <%= f.hidden_field :pe_e_5_ponta %>
  <%= f.hidden_field :pe_e_1 %>
  <%= f.hidden_field :pe_e_3 %>
  <%= f.hidden_field :pe_e_5 %>
  <%= f.hidden_field :pe_e_e1 %>
  <%= f.hidden_field :pe_e_e2 %>
  <%= f.hidden_field :pe_e_calcanhar %>

  <div id="modal_cores" class="modal">
    <div class="modal-content">
      <h4>Escolha um filamento</h4>
      <% @monofilamentos.each do |m|%>
          <a class="btn-floating btn-large waves-effect waves-light " style="color: <%= m.cor  %>; background-color: <%= m.cor %>"></a>
      <% end %>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>

</div>
  <div class="actions">
    <%= f.submit "Salvar", class:"btn" %>
  </div>
<% end %>

<script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
        var mao_direita = document.getElementById("mao_direita");
        var cnvs_mao_direita = document.getElementById("cnvs_mao_direita");
        var ctx = cnvs_mao_direita.getContext("2d");

        cnvs_mao_direita.style.position = "absolute";
        cnvs_mao_direita.style.left = mao_direita.offsetLeft + "px";
        cnvs_mao_direita.style.top = mao_direita.offsetTop + "px";
        //cnvs_mao_direita.width = mao_direita.width;
        //cnvs_mao_direita.height = mao_direita.height;


        const circles_mao_direita = [
            {//mao_d_costa
                x: 290,
                y: 162,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'mao_d_costa'
            },
            {//mindinho_d_ponta
                x: 30,
                y: 66,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'mindinho_d_ponta'
            },
            {//mindinho_d 32,116,13
                x: 32,
                y: 116,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'mindinho_d'
            },
            {//mao_direita 29,180,14
                x: 29,
                y: 180,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'mao_direita'
            },
            {//indicador_d_ponta 145,68,12
                x: 145,
                y: 68,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'indicador_d_ponta'
            },
            {//indicador_d 123,114,15
                x: 123,
                y: 114,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'indicador_d'
            },
            {//dedao_direito 172,176,14
                x: 172,
                y: 176,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'dedao_direito'
            }
        ];


        // draw circles
        circles_mao_direita.forEach(function(circle){
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#000000';
            ctx.stroke();
        });



        function handleMouseDown(e) {
            var offset =  cnvs_mao_direita.getBoundingClientRect();
            var mao_direita_offsetX = offset.left;
            var mao_direita_offsetY = offset.top;
            // get canvasXY of click
            canvasMouseX = parseInt(e.clientX - mao_direita_offsetX);
            canvasMouseY = parseInt(e.clientY - mao_direita_offsetY);

            // test if we clicked in any cities
            for (var i = 0; i < circles_mao_direita.length; i++) {
                var dx = canvasMouseX - circles_mao_direita[i].x;
                var dy = canvasMouseY - circles_mao_direita[i].y;
                var isInCircle = (dx * dx + dy * dy) < (circles_mao_direita[i].radius * circles_mao_direita[i].radius);
                console.log(isInCircle);
                if (isInCircle) {
                    openModal();
                }
            }
        }

        $("#cnvs_mao_direita").mousedown(function (e) {

            handleMouseDown(e);
        });

    });

    function isIntersect(point, circle) {
        return Math.sqrt((point.x-circle.x) * (point.x-circle.x)  + (point.y - circle.y) * (point.y - circle.y)) < circle.radius;
    }

    function Draw(){
        var img = document.getElementById("theImg");
        var coordenadas = document.getElementById("mao1").coords;
        var cnvs = document.getElementById("myCanvas");

        cnvs.style.position = "absolute";
        cnvs.style.left = img.offsetLeft + "px";
        cnvs.style.top = img.offsetTop + "px";


        var ctx = cnvs.getContext("2d");
        ctx.beginPath();
        ctx.arc(50, 159, 15, 0, 2 * Math.PI, false);
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#00ff00';
        ctx.fillStyle = "green";
        ctx.fill();
    }

    function openModal()
    {
        $('#modal_cores').openModal();
    }
</script>

