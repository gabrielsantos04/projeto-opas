<%= form_for(avaliacao_sensitiva) do |f| %>
  <% if avaliacao_sensitiva.errors.any? %>
    <div id="error_explanation" class="card-panel red white-text">
      <h5>Resolva os problemas a seguir antes de Salvar:</h5>

      <ul>
      <% avaliacao_sensitiva.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
<div class="card-panel">
  


    


  <div class="input">

    <%= f.label :data %>
    <%= f.date_field :data %>
    
  </div>

  <div class="row">
    <div class="col s12 l6 center-container">
      <!-- Image Map Generated by http://www.image-map.net/ -->
      <canvas id="cnvs_mao_direita" width=400 height=321 style="border: 1px solid red;"></canvas>
      <img id="mao_direita" src="/images/mao_direita.png">


    </div>
    <div class="col s12 l6">
      <!-- Image Map Generated by http://www.image-map.net/ -->
      <canvas id="cnvs_mao_esquerda" width=400 height=321 style="border: 1px solid red;"></canvas>
      <img id="mao_esquerda" src="/images/mao_esquerda.png">


    </div>
  </div>
  <div class="row">
    <div class="col s12 l6">
      <!-- Image Map Generated by http://www.image-map.net/ -->
      <canvas id="cnvs_pe_direito" width=400 height=321 style="border: 1px solid red;"></canvas>
      <img id="pe_direito" src="/images/pe_direito.png">


    </div>
    <div class="col s12 l6">
      <!-- Image Map Generated by http://www.image-map.net/ -->
      <canvas id="cnvs_pe_esquerdo" width=400 height=321 style="border: 1px solid red;"></canvas>
      <img id="pe_esquerdo" src="/images/pe_esquerdo.png">


    </div>
  </div>


  <%= f.hidden_field :avaliacao_notificacao_id  %>
  <%= f.hidden_field :dedao_direito %>
  <%= f.hidden_field :indicador_d_ponta %>
  <%= f.hidden_field :indicador_d %>
  <%= f.hidden_field :mindinho_d_ponta %>
  <%= f.hidden_field :mindinho_d %>
  <%= f.hidden_field :mao_direita %>
  <%= f.hidden_field :mao_d_costa %>
  <%= f.hidden_field :dedao_esquerdo %>
  <%= f.hidden_field :indicador_e_ponta %>
  <%= f.hidden_field :indicador_e %>
  <%= f.hidden_field :mindinho_e_ponta %>
  <%= f.hidden_field :mindinho_e %>
  <%= f.hidden_field :mao_esquerda %>
  <%= f.hidden_field :mao_e_costa %>
  <%= f.hidden_field :pe_direito %>
  <%= f.hidden_field :pe_d_1_ponta %>
  <%= f.hidden_field :pe_d_3_ponta %>
  <%= f.hidden_field :pe_d_5_ponta %>
  <%= f.hidden_field :pe_d_1 %>
  <%= f.hidden_field :pe_d_3 %>
  <%= f.hidden_field :pe_d_5 %>
  <%= f.hidden_field :pe_d_e1 %>
  <%= f.hidden_field :pe_d_e2 %>
  <%= f.hidden_field :pe_d_calcanhar %>
  <%= f.hidden_field :pe_esquerdo %>
  <%= f.hidden_field :pe_e_1_ponta %>
  <%= f.hidden_field :pe_e_3_ponta %>
  <%= f.hidden_field :pe_e_5_ponta %>
  <%= f.hidden_field :pe_e_1 %>
  <%= f.hidden_field :pe_e_3 %>
  <%= f.hidden_field :pe_e_5 %>
  <%= f.hidden_field :pe_e_e1 %>
  <%= f.hidden_field :pe_e_e2 %>
  <%= f.hidden_field :pe_e_calcanhar %>

  <div id="modal_cores" class="modal">
    <div class="modal-content">
      <h4>Escolha um filamento</h4>
      <div class="row">
      <% @monofilamentos.each do |m|%>
            <div class="col s1 l1">
          <a onclick="setFilamento(<%= m.id %>,'<%= m.cor %>');" class="btn-floating btn-large waves-effect waves-light modal-close" style="color: <%= m.cor  %>; background-color: <%= m.cor %>"></a>
            </div>
      <% end %>
        <div class="col s1 l1">
          <a  class="modal-close" onclick="limpaFilamento();"><i class="medium material-icons ">not_interested</i></a>
        </div>
      </div>
    </div>
  </div>

  <div id="modal_marcacoes" class="modal">
    <div class="modal-content">
      <h4>Escolha uma Marcação</h4>
      <div class="row">
        <div class="col s6 l2">
          <img src="/images/reabsorcao.png" class="modal-close" alt="Reabsorção" onclick="posicionaImagem('reabsorcao',true)">
        </div>
        <div class="col s6 l2">
          <img src="/images/garramovel.png" class="modal-close" alt="" onclick="posicionaImagem('garramovel',true)">
        </div>
        <div class="col s6 l2">
          <img src="/images/garrarigida.png" class="modal-close" alt="" onclick="posicionaImagem('garrarigida',true)">
        </div>
        <div class="col s6 l2">
          <img src="/images/ferida.png" class="modal-close" alt="" onclick="posicionaImagem('ferida',true)">
        </div>

      </div>
    </div>
  </div>

</div>
  <div class="actions">
    <%= f.submit "Salvar", class:"btn" %>
  </div>
<% end %>

<script type="text/javascript" charset="utf-8">
    var filamento;
    var canvas;
    var posicaox;
    var posicaoy;
    var marcacoes_mao_direita = [];
    var marcacoes_mao_esquerda = [];
    var marcacoes_pe_direito = [];
    var marcacoes_pe_esquerdo = [];

    function setFilamento(id,cor)
    {

        var ctx = canvas.getContext("2d");
        ctx.beginPath();
        ctx.arc(filamento.x, filamento.y, filamento.radius, 0, 2 * Math.PI, false);
        ctx.lineWidth = 2;
        ctx.fillStyle = cor;
        ctx.fill();
        $('#'+filamento.id).val(id);
    }

    function limpaFilamento()
    {
        var ctx = canvas.getContext("2d");
        ctx.beginPath();
        ctx.arc(filamento.x, filamento.y, filamento.radius, 0, 2 * Math.PI, false);
        ctx.lineWidth = 2;
        ctx.fillStyle = "#ffffff";
        ctx.fill();
        $('#'+filamento.id).val("");
    }

    function posicionaImagem(img,inserir)
    {
        var ctx = canvas.getContext("2d");
        ctx.beginPath();
        var imagem = new Image();
        imagem.src = "/images/"+img+".png";
        var x = posicaox - imagem.width/2;
        var y = posicaoy - imagem.height/2;
        ctx.drawImage(imagem,x,y);
        if(inserir == true)
        {
          $.get("/avaliacao_sensitivas/<%= @avaliacao_sensitiva.id %>/inserir_marcacao?imagem="+img+"&posicaox="+posicaox+"&posicaoy="+posicaoy+"&membro="+canvas.id, function(data)
          {
             if(data.marcacao)
             {
                 m = JSON.parse(data.marcacao);
                 switch(m.membro)
                 {
                     case 'cnvs_mao_direita':
                         marcacoes_mao_direita.push(m);
                         break;
                     case 'cnvs_mao_esquerda':
                         marcacoes_mao_esquerda.push(m);
                         break;
                     case 'cnvs_pe_direito':
                        marcacoes_pe_direito.push(m);
                         break;
                     case 'cnvs_pe_esquerdo':
                        marcacoes_pe_esquerdo.push(m);
                         break;
                 }
             }
          });
        }
    }

    function openModal(circle,cnv)
    {
        filamento = circle;
        canvas = cnv;
        $('#modal_cores').openModal();
    }

    function openModalMarcacoes(cnv,x,y)
    {
        canvas = cnv;
        posicaox = x;
        posicaoy = y;
        $('#modal_marcacoes').openModal();
    }

    function carregar() //$(document).ready(function()
    {
        //Mão Direita
        var mao_direita = document.getElementById("mao_direita");
        var cnvs_mao_direita = document.getElementById("cnvs_mao_direita");
        var ctx = cnvs_mao_direita.getContext("2d");

        cnvs_mao_direita.style.position = "absolute";
        cnvs_mao_direita.style.left = mao_direita.offsetLeft + "px";
        cnvs_mao_direita.style.top = mao_direita.offsetTop + "px";

        //Mão Esquerda
        var mao_esquerda = document.getElementById("mao_esquerda");
        var cnvs_mao_esquerda = document.getElementById("cnvs_mao_esquerda");
        var ctx_e = cnvs_mao_esquerda.getContext("2d");

        cnvs_mao_esquerda.style.position = "absolute";
        cnvs_mao_esquerda.style.left = mao_esquerda.offsetLeft + "px";
        cnvs_mao_esquerda.style.top = mao_esquerda.offsetTop + "px";

        //Pé Direito
        var pe_direito = document.getElementById("pe_direito");
        var cnvs_pe_direito = document.getElementById("cnvs_pe_direito");
        var ctx_pe_d = cnvs_pe_direito.getContext("2d");

        cnvs_pe_direito.style.position = "absolute";
        cnvs_pe_direito.style.left = pe_direito.offsetLeft + "px";
        cnvs_pe_direito.style.top = pe_direito.offsetTop + "px";

        //Pé Esquerdo
        var pe_esquerdo = document.getElementById("pe_esquerdo");
        var cnvs_pe_esquerdo = document.getElementById("cnvs_pe_esquerdo");
        var ctx_pe_e = cnvs_pe_esquerdo.getContext("2d");

        cnvs_pe_esquerdo.style.position = "absolute";
        cnvs_pe_esquerdo.style.left = pe_esquerdo.offsetLeft + "px";
        cnvs_pe_esquerdo.style.top = pe_esquerdo.offsetTop + "px";

        //carrega as marcacoes
        <% @avaliacao_sensitiva.marcacaos.each do |m| %>
            var marca = "<%= m.membro %>";
            switch(marca)
            {
                case 'cnvs_mao_direita':
                    marcacoes_mao_direita.push(<%= m.to_json.to_s.html_safe %>);
                    canvas = cnvs_mao_direita;
                    posicaox = '<%= m.posicaox %>';
                    posicaoy = '<%= m.posicaoy %>';
                    posicionaImagem('<%= m.imagem %>',false);
                    break;
                case 'cnvs_mao_esquerda':
                    marcacoes_mao_esquerda.push(<%= m.to_json.to_s.html_safe %>);
                    canvas = cnvs_mao_esquerda;
                    posicaox = '<%= m.posicaox %>';
                    posicaoy = '<%= m.posicaoy %>';
                    posicionaImagem('<%= m.imagem %>',false);
                    break;
                case 'cnvs_pe_direito':
                    marcacoes_pe_direito.push(<%= m.to_json.to_s.html_safe %>);
                    canvas = cnvs_pe_direito;
                    posicaox = '<%= m.posicaox %>';
                    posicaoy = '<%= m.posicaoy %>';
                    posicionaImagem('<%= m.imagem %>',false);
                    break;
                case 'cnvs_pe_esquerdo':
                    marcacoes_pe_esquerdo.push(<%= m.to_json.to_s.html_safe %>);
                    canvas = cnvs_pe_esquerdo;
                    posicaox = '<%= m.posicaox %>';
                    posicaoy = '<%= m.posicaoy %>';
                    posicionaImagem('<%= m.imagem %>',false);
                    break;
            }

        <% end %>

        const circles_mao_direita = [
            {//mao_d_costa
                x: 290,
                y: 162,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mao_d_costa',
                img: 'mao_direita'
            },
            {//mindinho_d_ponta
                x: 30,
                y: 66,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mindinho_d_ponta',
                img: 'mao_direita'
            },
            {//mindinho_d 32,116,13
                x: 32,
                y: 116,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mindinho_d',
                img: 'mao_direita'
            },
            {//mao_direita 29,180,14
                x: 29,
                y: 180,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mao_direita',
                img: 'mao_direita'
            },
            {//indicador_d_ponta 145,68,12
                x: 145,
                y: 68,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_indicador_d_ponta',
                img: 'mao_direita'
            },
            {//indicador_d 123,114,15
                x: 123,
                y: 114,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_indicador_d',
                img: 'mao_direita'
            },
            {//dedao_direito 172,176,14
                x: 172,
                y: 176,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_dedao_direito',
                img: 'mao_direita'
            }
        ];

        const circles_mao_esquerda = [
            {//mao_e_costa 106,164,13
                x: 106,
                y: 164,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mao_e_costa',
                img: 'mao_esquerda'
            },
            {//mindinho_e_ponta 367,65,13
                x: 367,
                y: 65,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mindinho_e_ponta',
                img: 'mao_esquerda'
            },
            {//mindinho_e 366,109,14
                x: 366,
                y: 109,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mindinho_e',
                img: 'mao_esquerda'
            },
            {//mao_esquerda 370,177,15
                x: 370,
                y: 177,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_mao_esquerda',
                img: 'mao_esquerda'
            },
            {//indicador_e_ponta 255,69,15
                x: 255,
                y: 69,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_indicador_e_ponta',
                img: 'mao_esquerda'
            },
            {//indicador_e 277,122,15
                x: 277,
                y: 122,
                radius: 15,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_indicador_e',
                img: 'mao_esquerda'
            },
            {//dedao_esquerdo 227,179,13
                x: 227,
                y: 179,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_dedao_esquerdo',
                img: 'mao_esquerda'
            }
        ];

        //pé direito
        const circles_pe_direito = [
            {//pe_direito 98,65,11
                x: 98,
                y: 65,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_direito',
                img: 'pe_direito'
            },
            {//pe_d_5_ponta 233,71,11
                x: 233,
                y: 71,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_5_ponta',
                img: 'pe_direito'
            },
            {//pe_d_5 238,103,11
                x: 238,
                y: 103,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_5',
                img: 'pe_direito'
            },
            {//pe_d_3_ponta 260,44,12
                x: 260,
                y: 44,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_3_ponta',
                img: 'pe_direito'
            },
            {//pe_d_3 270,79,13
                x: 270,
                y: 79,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_3',
                img: 'pe_direito'
            },
            {//pe_d_1_ponta 299,27,14
                x: 299,
                y: 27,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_1_ponta',
                img: 'pe_direito'
            },
            {//pe_d_1 310,61,14
                x: 310,
                y: 61,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_1',
                img: 'pe_direito'
            },
            {//pe_d_e1 249,160,12 ponto na parte externa do pé
                x: 249,
                y: 160,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_e1',
                img: 'pe_direito'
            },
            {//pe_d_e2 307,166,13 ponto na parte interna do pé
                x: 307,
                y: 166,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_e2',
                img: 'pe_direito'
            },
            {//pe_d_calcanhar 287,242,11
                x: 287,
                y: 242,
                radius: 11,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_d_calcanhar',
                img: 'pe_direito'
            }
        ];

        //Pé Esquerdo
        const circles_pe_esquerdo = [
            {//pe_direito 130,65,13
                x: 130,
                y: 65,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_esquerdo',
                img: 'pe_esquerdo'
            },
            {//pe_e_5_ponta 323,71,12
                x: 323,
                y: 71,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_5_ponta',
                img: 'pe_esquerdo'
            },
            {//pe_e_5 318,100,12
                x: 318,
                y: 100,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_5',
                img: 'pe_esquerdo'
            },
            {//pe_e_3_ponta 297,41,12
                x: 297,
                y: 41,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_3_ponta',
                img: 'pe_esquerdo'
            },
            {//pe_e_3 287,68,12
                x: 287,
                y: 68,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_3',
                img: 'pe_esquerdo'
            },
            {//pe_e_1_ponta 256,26,15
                x: 256,
                y: 26,
                radius: 14,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_1_ponta',
                img: 'pe_esquerdo'
            },
            {//pe_e_1 247,59,13
                x: 247,
                y: 59,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_1',
                img: 'pe_esquerdo'
            },
            {//pe_e_e1 307,163,12  ponto na parte externa do pé
                x: 307,
                y: 163,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_e1',
                img: 'pe_esquerdo'
            },
            {//pe_e_e2 245,165,12  ponto na parte interna do pé
                x: 245,
                y: 165,
                radius: 12,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_e2',
                img: 'pe_esquerdo'
            },
            {//pe_e_calcanhar 268,237,13
                x: 268,
                y: 237,
                radius: 13,
                color: 'rgb(0,0,0)',
                id:'avaliacao_sensitiva_pe_e_calcanhar',
                img: 'pe_esquerdo'
            }
        ];


        // draw circles
        circles_mao_direita.forEach(function(circle){
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#000000';
            ctx.stroke();
        });

        circles_mao_esquerda.forEach(function(circle){
            ctx_e.beginPath();
            ctx_e.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            ctx_e.lineWidth = 2;
            ctx_e.strokeStyle = '#000000';
            ctx_e.stroke();
        });

        circles_pe_direito.forEach(function(circle){
            ctx_pe_d.beginPath();
            ctx_pe_d.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            ctx_pe_d.lineWidth = 2;
            ctx_pe_d.strokeStyle = '#000000';
            ctx_pe_d.stroke();
        });

        circles_pe_esquerdo.forEach(function(circle){
            ctx_pe_e.beginPath();
            ctx_pe_e.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            ctx_pe_e.lineWidth = 2;
            ctx_pe_e.strokeStyle = '#000000';
            ctx_pe_e.stroke();
        });


        //Handle click
        $("#cnvs_mao_direita").mousedown(function (e) {

            handleMouseDown(e,circles_mao_direita,cnvs_mao_direita,marcacoes_mao_direita);
        });

        $("#cnvs_mao_esquerda").mousedown(function (e) {

            handleMouseDown(e,circles_mao_esquerda,cnvs_mao_esquerda,marcacoes_mao_esquerda);
        });

        $("#cnvs_pe_direito").mousedown(function (e) {

            handleMouseDown(e,circles_pe_direito,cnvs_pe_direito,marcacoes_pe_direito);
        });

        $("#cnvs_pe_esquerdo").mousedown(function (e) {

            handleMouseDown(e,circles_pe_esquerdo,cnvs_pe_esquerdo,marcacoes_pe_esquerdo);
        });

        //Pinta novamente para edição
        circles_mao_direita.forEach(function(circle)
        {
            if($('#'+circle.id).val() != '')
            {

                var cor;
                switch(circle.id)
                {
                    case 'avaliacao_sensitiva_mao_d_costa':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mao_d_costa).cor if @avaliacao_sensitiva.mao_d_costa.present? %>'
                        break;
                    case 'avaliacao_sensitiva_dedao_direito':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.dedao_direito).cor if @avaliacao_sensitiva.dedao_direito.present? %>'
                        break;
                    case 'avaliacao_sensitiva_indicador_d_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.indicador_d_ponta).cor if @avaliacao_sensitiva.indicador_d_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_indicador_d':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.indicador_d).cor if @avaliacao_sensitiva.indicador_d.present? %>'
                        break;
                    case 'avaliacao_sensitiva_mindinho_d_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mindinho_d_ponta).cor if @avaliacao_sensitiva.mindinho_d_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_mindinho_d':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mindinho_d).cor if @avaliacao_sensitiva.mindinho_d.present? %>'
                        break;
                    case 'avaliacao_sensitiva_mao_direita':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mao_direita).cor if @avaliacao_sensitiva.mao_direita.present? %>'
                        break;

                }

                ctx.beginPath();
                ctx.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
                ctx.lineWidth = 2;
                ctx.fillStyle = cor;
                ctx.fill();
            }
        });

        circles_mao_esquerda.forEach(function(circle)
        {
            if($('#'+circle.id).val())
            {
                var cor;
                switch(circle.id)
                {
                    case 'avaliacao_sensitiva_mao_e_costa':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mao_e_costa).cor  if @avaliacao_sensitiva.mao_e_costa.present? %>'
                        break;
                    case 'avaliacao_sensitiva_dedao_esquerdo':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.dedao_esquerdo).cor if @avaliacao_sensitiva.dedao_esquerdo.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_indicador_e_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.indicador_e_ponta).cor  if @avaliacao_sensitiva.indicador_e_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_indicador_e':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.indicador_e).cor if @avaliacao_sensitiva.indicador_e.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_mindinho_e_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mindinho_e_ponta).cor if @avaliacao_sensitiva.mindinho_e_ponta.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_mindinho_e':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mindinho_e).cor if @avaliacao_sensitiva.mindinho_e.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_mao_esquerda':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.mao_esquerda).cor if @avaliacao_sensitiva.mao_esquerda.present?  %>'
                        break;

                }

                ctx_e.beginPath();
                ctx_e.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
                ctx_e.lineWidth = 2;
                ctx_e.fillStyle = cor;
                ctx_e.fill();
            }
        });

        circles_pe_direito.forEach(function(circle)
        {
            if($('#'+circle.id).val() != '')
            {
                var cor;
                switch(circle.id)
                {
                    case 'avaliacao_sensitiva_pe_direito':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_direito).cor  if @avaliacao_sensitiva.pe_direito.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_1_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_1_ponta).cor  if @avaliacao_sensitiva.pe_d_1_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_1':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_1).cor if @avaliacao_sensitiva.pe_d_1.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_3_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_3_ponta).cor if @avaliacao_sensitiva.pe_d_3_ponta.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_3':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_3).cor if @avaliacao_sensitiva.pe_d_3.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_5_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_5_ponta).cor if @avaliacao_sensitiva.pe_d_5_ponta.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_5':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_5).cor  if @avaliacao_sensitiva.pe_d_5.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_e1':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_e1).cor if @avaliacao_sensitiva.pe_d_e1.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_e2':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_e2).cor if @avaliacao_sensitiva.pe_d_e2.present?  %>'
                        break;
                    case 'avaliacao_sensitiva_pe_d_calcanhar':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_d_calcanhar).cor  if @avaliacao_sensitiva.pe_d_calcanhar.present? %>'
                        break;

                }

                ctx_pe_d.beginPath();
                ctx_pe_d.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
                ctx_pe_d.lineWidth = 2;
                ctx_pe_d.fillStyle = cor;
                ctx_pe_d.fill();
            }
        });

        circles_pe_esquerdo.forEach(function(circle)
        {
            if($('#'+circle.id).val() != '')
            {

                var cor;
                switch(circle.id)
                {
                    case 'avaliacao_sensitiva_pe_esquerdo':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_esquerdo).cor if @avaliacao_sensitiva.pe_esquerdo.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_1_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_1_ponta).cor if @avaliacao_sensitiva.pe_e_1_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_1':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_1).cor if @avaliacao_sensitiva.pe_e_1.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_3_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_3_ponta).cor if @avaliacao_sensitiva.pe_e_3_ponta.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_3':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_3).cor if @avaliacao_sensitiva.pe_e_3.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_5_ponta':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_5_ponta).cor  if @avaliacao_sensitiva.pe_e_5_ponta.present?%>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_5':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_5).cor if @avaliacao_sensitiva.pe_e_5.present? %>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_e1':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_e1).cor  if @avaliacao_sensitiva.pe_e_e1.present?%>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_e2':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_e2).cor  if @avaliacao_sensitiva.pe_e_e2.present?%>'
                        break;
                    case 'avaliacao_sensitiva_pe_e_calcanhar':
                        cor = '<%= Monofilamento.find(@avaliacao_sensitiva.pe_e_calcanhar).cor if @avaliacao_sensitiva.pe_e_calcanhar.present? %>'
                        break;

                }

                ctx_pe_e.beginPath();
                ctx_pe_e.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
                ctx_pe_e.lineWidth = 2;
                ctx_pe_e.fillStyle = cor;
                ctx_pe_e.fill();
            }
        });

    };

  function handleMouseDown(e,circles,canvas,images)
  {
      var offset =  canvas.getBoundingClientRect();
      var offsetX = offset.left;
      var offsetY = offset.top;
      var isInCircle = false;
      //Obtem o click do mouse descontando o tamanho da tela
      canvasMouseX = parseInt(e.clientX - offsetX);
      canvasMouseY = parseInt(e.clientY - offsetY);

      //Verifica se o clice foi dentro de um dos circulos
      for (var i = 0; i < circles.length; i++) {
          var dx = canvasMouseX - circles[i].x;
          var dy = canvasMouseY - circles[i].y;
          isInCircle = (dx * dx + dy * dy) < (circles[i].radius * circles[i].radius);

          if (isInCircle == true) {
              openModal(circles[i],canvas);
              break;
          }
      }

      //Verifica se o clice foi dentro de uma das marcacoes
      for (var i = 0; i < images.length; i++)
      {

          if( (canvasMouseX >= images[i].posicaox - 20 && canvasMouseX <= images[i].posicaox + 20) && (canvasMouseY >= images[i].posicaoy - 20 && canvasMouseY <= images[i].posicaoy + 20) )
          {
              $.get("/avaliacao_sensitivas/remover_marcacao?marca="+images[i].id,function(data)
              {
                if(data.msg)
                {
                  window.location = '<%= edit_avaliacao_sensitiva_path(@avaliacao_sensitiva) %>';
                }
              });
              //delete images[i];
              isInCircle = true;
              break;
          }

      }

      if(isInCircle == false)
      {
          openModalMarcacoes(canvas,canvasMouseX,canvasMouseY);
      }
  }

setTimeout(carregar,1000);


</script>

